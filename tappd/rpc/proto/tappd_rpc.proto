syntax = "proto3";

import "google/protobuf/empty.proto";

package tappd;

service Tappd {
  // Derive a key from a key path
  // Returns a key and a certificate chain
  rpc DeriveKey(DeriveKeyArgs) returns (DeriveKeyResponse) {}

  // Get a TDX quote
  rpc TdxQuote(TdxQuoteArgs) returns (TdxQuoteResponse) {}
}

// The request to derive a key
message DeriveKeyArgs {
  // Path to the key to derive
  string path = 1;
  // Subject of the certificate to request
  string subject = 2;
}

// The response to a DeriveKey request
message DeriveKeyResponse {
  // Derived key
  string key = 1;
  // Certificate chain
  repeated string certificate_chain = 2;
}

// The request to get a TDX quote
message TdxQuoteArgs {
  // Report data
  bytes report_data = 1;
}

message TdxQuoteResponse {
  // TDX quote
  bytes quote = 1;
  // Event log
  string event_log = 2;
}


service Worker {
  // Get worker info
  rpc Info(google.protobuf.Empty) returns (WorkerInfo) {}
}

// The request to derive a key
message WorkerInfo {
  // Worker ID
  string app_id = 1;
  // App certificate
  string app_cert = 2;
  // TCB info
  string tcb_info = 3;
}
